<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Gabarite – Versão Legislação</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input[type="text"], textarea { width: 320px; }
  </style>
</head>
<body>
  <h1>Gabarite – Versão Legislação</h1>
  <form id="formulario">
    <div>
      Ação:
      <label><input type="radio" name="acao" value="Resumir" checked>Resumir</label>
      <label><input type="radio" name="acao" value="Esquematizar">Esquematizar</label>
    </div>
    <div>
      Arquivo base (.pdf, .docx): <input type="file" name="arquivo_base" id="arquivo_base">
      (opcional: páginas ex: 1-5,7) <input type="text" id="paginas" size="8">
      <button type="button" onclick="extrairTexto()">Extrair Texto</button>
    </div>
    <textarea id="text_base" rows="6" placeholder="Texto extraído aparece aqui"></textarea>
    <div>
      Banca:
      <label><input type="radio" name="banca" value="Cespe" checked>Cespe</label>
      <label><input type="radio" name="banca" value="FGV">FGV</label>
      <label><input type="radio" name="banca" value="FCC">FCC</label>
      <label><input type="radio" name="banca" value="Verbena">Verbena</label>
      <label><input type="radio" name="banca" value="Outra">Outra</label>
    </div>
    <div>
      Nível:
      <label><input type="radio" name="nivel" value="Fácil">Fácil</label>
      <label><input type="radio" name="nivel" value="Médio" checked>Médio</label>
      <label><input type="radio" name="nivel" value="Difícil">Difícil</label>
    </div>
    <div>
      Tom:
      <label><input type="radio" name="tom" value="Técnico" checked>Técnico</label>
      <label><input type="radio" name="tom" value="Didático">Didático</label>
      <label><input type="radio" name="tom" value="Concursos">Concursos</label>
      <label><input type="radio" name="tom" value="Personalizado">Personalizado</label>
    </div>
    <div>
      Estilo de linguagem: <input type="text" name="estilo_linguagem" value="padrão">
    </div>
    <div>
      Comando para IA: <input type="text" name="comando" value="esquematizar">
    </div>
    <div>
      Cargo: <input type="text" name="cargo">
      Ano: <input type="text" name="ano">
    </div>
    <div>
      Questões da banca (texto):<br>
      <textarea name="questoes_texto" rows="3" cols="50"></textarea>
    </div>
    <div>
      Ou arquivo de questões (.txt, .docx, .csv): <input type="file" name="questoes_file">
    </div>
    <button type="submit">Enviar para IA</button>
  </form>
  <h3>Resultado:</h3>
  <pre id="resultado"></pre>

  <script>
    const API_BASE = "https://resumos.onrender.com";

    async function extrairTexto() {
      const input = document.getElementById('arquivo_base');
      const paginas = document.getElementById('paginas').value;
      if (!input.files[0]) { alert("Selecione um arquivo."); return; }
      const fd = new FormData();
      fd.append("file", input.files[0]);
      if (paginas) fd.append("paginas", paginas);

      const resp = await fetch(API_BASE + "/upload", { method: "POST", body: fd });
      const data = await resp.json();
      document.getElementById("text_base").value = data.text || (data.error || "Erro na extração!");
    }

    document.getElementById("formulario").onsubmit = async function(e) {
      e.preventDefault();
      const fd = new FormData(this);
      fd.set("text", document.getElementById("text_base").value); // Usa texto extraído
      // Necessário para manter compatível com backend
      if (!fd.get("text")) { alert("Extraia o texto base antes de enviar."); return; }

      const resp = await fetch(API_BASE + "/process", { method: "POST", body: fd });
      const data = await resp.json();
      document.getElementById("resultado").textContent = data.processed_text || (data.error || "Erro ao processar!");
    };
  </script>
</body>
</html>
